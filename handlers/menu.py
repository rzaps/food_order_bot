# –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª?
#
# –ó–∞–≥—Ä—É–∂–∞–µ—Ç –º–µ–Ω—é –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
# –†–∞–∑–±–∏–≤–∞–µ—Ç –µ–≥–æ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–ª—é–¥.

# –ö–æ–º–∞–Ω–¥–∞ /menu
# üîπ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ –±–∞–∑—ã.
# üîπ –°–æ–∑–¥–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
# üîπ –ï—Å–ª–∏ –º–µ–Ω—é –ø—É—Å—Ç–æ–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.
#
# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
# üîπ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é.
# üîπ –ë–æ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –±–ª—é–¥ –∏–∑ –±–∞–∑—ã.
# üîπ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –±–ª—é–¥–∞ + —Ü–µ–Ω—É.
#
# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
# –î–ª—è —Ä–∞–±–æ—Ç—ã menu.py –Ω—É–∂–Ω—ã:
#
# models.py ‚Äì –ø–æ–ª—É—á–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –±–ª—é–¥–∞.
# bot.py ‚Äì –≥–ª–∞–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç –±–æ—Ç–∞.
# telebot ‚Äì –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ñ–æ—Ç–æ


# –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?
# –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ "‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"
#
# –ò—Å–ø–æ–ª—å–∑—É–µ–º InlineKeyboardMarkup() –∏ InlineKeyboardButton().
# callback_data=f"add_{dish_id}" ‚Äî –ø–µ—Ä–µ–¥–∞–µ–º ID –±–ª—é–¥–∞ –≤ callback.
# –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ order.py.
# –¢–µ–ø–µ—Ä—å show_dishes() –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –±–ª—é–¥, –∞
#
# –ö–∞—Ä—Ç–∏–Ω–∫—É –±–ª—é–¥–∞.
# –ù–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É.
# –ö–Ω–æ–ø–∫—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É.
#
# 1Ô∏è‚É£ show_dishes() –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ menu.py
# 2Ô∏è‚É£ –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–º—É —Å–ø–∏—Å–æ–∫ –±–ª—é–¥
# 3Ô∏è‚É£ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª—é–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
#
# –§–æ—Ç–æ –±–ª—é–¥–∞
# –ù–∞–∑–≤–∞–Ω–∏–µ + —Ü–µ–Ω–∞
# –ö–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" –∏ "–£–¥–∞–ª–∏—Ç—å"




import telebot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
from database.models import MenuItem
from bot_instance import bot


# === –ö–æ–º–∞–Ω–¥–∞ /menu ===
@bot.message_handler(commands=['menu'])
def show_menu(message):
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±–ª—é–¥"""
    categories = MenuItem.get_categories()

    if categories:
        keyboard = telebot.types.ReplyKeyboardMarkup(resize_keyboard=True,
                                                     one_time_keyboard=True)
        for category in categories:
            keyboard.add(telebot.types.KeyboardButton(category))
        bot.send_message(message.chat.id, "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
                         reply_markup=keyboard)
    else:
        bot.send_message(message.chat.id, "–ú–µ–Ω—é –ø–æ–∫–∞ –ø—É—Å—Ç–æ–µ!")


# === –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ===
@bot.message_handler(
    func=lambda message: message.text in MenuItem.get_categories())
def show_dishes(message):
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –±–ª—é–¥ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏ '–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É'"""
    category = message.text
    dishes = MenuItem.get_dishes_by_category(category)

    if dishes:
        for dish_id, name, price, image_url in dishes:
            # –°–æ–∑–¥–∞–µ–º inline-–∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å" –∏ "–£–¥–∞–ª–∏—Ç—å"
            markup = InlineKeyboardMarkup()
            markup.add(InlineKeyboardButton("‚ûï –î–æ–±–∞–≤–∏—Ç—å",
                                            callback_data=f"add_{dish_id}"))
            markup.add(InlineKeyboardButton("‚ùå –£–¥–∞–ª–∏—Ç—å",
                                            callback_data=f"remove_{name}"))

            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–ª—é–¥–∞, –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É + –∫–Ω–æ–ø–∫–∏
            bot.send_photo(message.chat.id, image_url,
                           caption=f"{name} - {price}‚ÇΩ", reply_markup=markup)
    else:
        bot.send_message(message.chat.id, "–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –±–ª—é–¥.")
